<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Region (uring.Uring.Region)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">uring</a> &#x00BB; <a href="../index.html">Uring</a> &#x00BB; Region</nav><header class="odoc-preamble"><h1>Module <code><span>Uring.Region</span></code></h1><p><code>Region</code> handles carving up a block of external memory into smaller chunks. This is currently just a slab allocator of a fixed size, on the basis that most IO operations operate on predictable chunks of memory. Since the block of memory in a region is contiguous, it can be used in Uring's fixed buffer model to map it into kernel space for more efficient IO.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p><code>t</code> is a contiguous region of memory</p></div></div><div class="odoc-spec"><div class="spec type" id="type-chunk" class="anchored"><a href="#type-chunk" class="anchor"></a><code><span><span class="keyword">type</span> chunk</span></code></div><div class="spec-doc"><p><code>chunk</code> is an offset into a region of memory allocated from some region <code>t</code>. It is of a length set when the region <code>t</code> associated with it was initialised.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-No_space" class="anchored"><a href="#exception-No_space" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">No_space</span></span></code></div><div class="spec-doc"><p><code>No_space</code> is raised when an allocation request cannot be satisfied.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>block_size:int <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Cstruct</span>.buffer <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>init ~block_size buf slots</code> initialises a region from the buffer <code>buf</code> with total size of <code>block_size * slots</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-alloc" class="anchored"><a href="#val-alloc" class="anchor"></a><code><span><span class="keyword">val</span> alloc : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-chunk">chunk</a></span></code></div><div class="spec-doc"><p><code>alloc t</code> will allocate a single chuck of length <code>block_size</code> from the region <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-free" class="anchored"><a href="#val-free" class="anchor"></a><code><span><span class="keyword">val</span> free : <span><a href="#type-chunk">chunk</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>free chunk</code> will return the memory <code>chunk</code> back to the region <code>t</code> where it can be reallocated.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-length" class="anchored"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : <span><a href="#type-chunk">chunk</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>length chunk</code> is the block size.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_offset" class="anchored"><a href="#val-to_offset" class="anchor"></a><code><span><span class="keyword">val</span> to_offset : <span><a href="#type-chunk">chunk</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>to_offset chunk</code> will convert the <code>chunk</code> into an integer offset in its associated region. This can be used in IO calls involving that memory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_cstruct" class="anchored"><a href="#val-to_cstruct" class="anchor"></a><code><span><span class="keyword">val</span> to_cstruct : <span>?len:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-chunk">chunk</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Cstruct</span>.t</span></code></div><div class="spec-doc"><p><code>to_cstruct chunk</code> is a cstruct of <code>chunk</code>'s slice of the region. Note that this is a zero-copy view into the underlying region <code>t</code> and so <code>chunk</code> should not be freed until this cstruct is no longer used.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">len</span> <p>Use only the first <code>len</code> bytes of <code>chunk</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-to_bigstring" class="anchored"><a href="#val-to_bigstring" class="anchor"></a><code><span><span class="keyword">val</span> to_bigstring : <span>?len:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-chunk">chunk</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Cstruct</span>.buffer</span></code></div><div class="spec-doc"><p><code>to_bigstring</code> is like <a href="#val-to_cstruct"><code>to_cstruct</code></a>, but creates a <code>Bigarray</code>. Note that this is a zero-copy view into the underlying region <code>t</code> and so <code>chunk</code> should not be freed until this Bigarray reference is no longer used.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">len</span> <p>Use only the first <code>len</code> bytes of <code>chunk</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span>?len:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-chunk">chunk</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>to_string ?len chunk</code> will return a copy of <code>chunk</code> as an OCaml string.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">len</span> <p>Use only the first <code>len</code> bytes of <code>chunk</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-avail" class="anchored"><a href="#val-avail" class="anchor"></a><code><span><span class="keyword">val</span> avail : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>avail t</code> is the number of free chunks of memory remaining in the region.</p></div></div></div></body></html>